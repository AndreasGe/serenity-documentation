With Selenium BDD it is possible create tight one and two-way integration with JIRA

=== Getting started with Serenity BDD/JIRA integration

https://www.atlassian.com/software/jira[JIRA] is a popular issue tracking system that is also often used for Agile project and requirements management. Many teams using JIRA store their requirements electronically in the form of story cards and epics in JIRA

Suppose we are implementing a Frequent Flyer application for an airline. The idea is that travellers will earn points when they fly with our airline, based on the distance they fly. Travellers start out with a “Bronze” status, and can earn a better status by flying more frequently. Travellers with a higher frequent flyer status benefit from advantages such as lounge access, prioritized boarding, and so on. One of the story cards for this feature might look like the following:

[[frequent-flyer-story-card]]
.Frequent Flyer story card
image::frequent-flyer-story-card.png[]

This story contains a description following one of the frequently-used formats for user story descriptions (“as a..I want..so that”). It also contains a custom “Acceptance Criteria” field, where we can write down a brief outline of the “definition of done” for this story.

These stories can be grouped into epics, and placed into sprints for project planning, as illustrated in the JIRA Agile board shown here:

[[jira-agile-board]]
.JIRA sample agile board
image::jira-agile-board.png[]

As illustrated in the story card, each of these stories has a set of acceptance criteria, which we can build into more detailed scenarios, based on concrete examples. We can then automate these scenarios using a BDD tool like JBehave.

The story in <<frequent-flyer-story-card>> describes how many points members need to earn to be awarded each status level. A JBehave scenario for the story card illustrated earlier might look like this:

[source,gherkin]
----
include::{srcdir}/jira-integration-scenarios/sample-jbehabe-scenatio.story[]
----

Serenity lets you associate JBehave stories or JUnit tests with a JIRA card using the @issue meta tag (illustrated above), or the equivalent @Issue annotation in JUnit. At the most basic level, this will generate links back to the corresponding JIRA cards in your test reports, as illustrated here:

[[jira-serenity-report]]
.Serenity report with links to JIRA
image::jira-serenity-report.png[]

For this to work, Serenity needs to know where your JIRA server. The simplest way to do this is to define the following properties in a file called thucydides.properties in your project root directory:

[source,gherkin]
----
include::{srcdir}/jira-integration-scenarios/serenity.properties[]
----

You can also set these properties up in your Maven pom.xml file or pass them in as system properties.

=== Feature Coverage
But test results only report part of the picture. If you are using JIRA to store your stories and epics, you can use these to keep track of progress. But how do you know what automated acceptance tests have been implemented for your stories and epics, and, equally importantly, how do you know which stories or epics have no automated acceptance tests? In agile terms, a story cannot be declared “done” until the automated acceptance tests pass. Furthermore, we need to be confident not only that the tests exist, but they test the right requirements, and that they test them sufficiently well.

We call this idea of measuring the number (and quality) of the acceptance tests for each of the features we want to build “feature coverage”. Serenity can provide feature coverage reporting in addition to the more conventional test results. If you are using JIRA, you will need to add thucydides-jira-requirements-provider to the dependencies section of your pom.xml file:

[source,xml]
----
include::{srcdir}/jira-integration-scenarios/sample-dependency.xml[]
----

(The actual version number might be different for you – always take a look at http://search.maven.org/#search%7Cga%7C1%7Cthucydides[Maven Central] to know what the latest version is).

You will also need to add this dependency to the Serenity reporting plugin configuration:

[source,xml]
----
include::{srcdir}/jira-integration-scenarios/serenity-reporting-plugin-configuration.xml[]
----

Now, when you run the tests, Serenity will query JIRA to determine the epics and stories that you have defined, and list them in the Requirements page. This page gives you an overview of how many requirements (epics and stories) have passing tests (green), how many have failing (red) or broken (orange) tests, and how many have no tests at all (blue):

[[serenity-jira-requirements-view]]
.Requirements in Serenity report
image::serenity-jira-requirements-view.png[]

If you click on an epic, you can see the stories defined for the epic, including an indicator (in the “Coverage” column) of how well each story has been tested.

[[serenity-jira-report-epic-details]]
.Epic details in Serenity report
image::serenity-jira-report-epic-details.png[]

From here, you may want to drill down into the details about a given story, including what acceptance tests have been defined for this story, and whether they ran successfully:

[[serenity-jira-story-report]]
.Story in Serenity report
image::serenity-jira-story-report.png[]

Both JIRA and the JIRA-Serenity integration are quite flexible. We saw earlier that we had configured a custom “Acceptance Criteria” field in our JIRA stories. We have displayed this custom field in the report shown above by including it in the thucydides.properties file, like this:

----
jira.custom.field.1=Acceptance Criteria
----

Serenity reads the narrative text appearing in this report (“As a frequent flyer…”) from the Descriptionfield of the corresponding JIRA card. We can override this behavior and get Serenity to read this value from a different custom field using the `jira.custom.narrative.field` property. For example, some teams use a custom field called “User Story” to store the narrative text, instead of the Description field. We could get Serenity to use this field as follows:

----
jira.custom.narrative.field=User Story
----

